import XCTest

enum Direction: Character {
    case up = "^"
    case left = "<"
    case right = ">"
    case down = "v"
    
    mutating func turn() {
        switch self {
        case .up: self = .right
        case .left: self = .up
        case .right: self = .down
        case .down: self = .left
        }
    }
}

class Tests24Day6: XCTestCase {
    func testDay2Example() { solutionDay6(input: inputExample, expected: 41) }
    func testDay2() { solutionDay6(input: input, expected: 4559) }
    func testDay2Pt2Example() { solutionDay6Pt2(input: inputExample, expected: 6) }
    func testDay2Pt2() { solutionDay6Pt2(input: input, expected: 1604) }

    func solutionDay6Pt2(input: String, expected: Int) {
        let originalInput = input.components(separatedBy: "\n").map { Array($0) }
        let startingPoint = getStartingPoint(originalInput)
        var (i, j) = startingPoint
        var currDirection = Direction.up
        
        var loopCount = 0
        var moveCount = 0
        var exitFound = false
        
        for x in 0..<originalInput.count {
            for y in 0..<originalInput[x].count {
                guard originalInput[x][y] == "." else { continue }
                var input = originalInput
                input[x][y] = "#"
//                pretty(input)
               
                exitFound = false
                currDirection = Direction.up
                moveCount = 0
                (i, j) = startingPoint
                while true {
//                    pretty(input)
                    if moveCount > 6000 { break } // tested up to 15000 cycle to make sure of result
                    // move up
                    if currDirection == .up {
                        if i > 0 && input[i-1][j] != "#" {
                            input[i-1][j] = Direction.up.rawValue
                            input[i][j] = "X"
                            i = i-1
                        } else if i == 0 {
                            input[i][j] = "X"
                            exitFound = true
                            break
                        } else if input[i-1][j] == "#" {
                            currDirection.turn()
                        } else {
                            fatalError("This should not happen")
                        }
                    }
                    
                    // move right
                    if currDirection == .right {
                        if j+1 < input[i].count && input[i][j+1] != "#" {
                            input[i][j+1] = Direction.right.rawValue
                            input[i][j] = "X"
                            j = j+1
                        } else if j+1 == input[i].count {
                            input[i][j] = "X"
                            exitFound = true
                            break
                        } else if input[i][j+1] == "#" {
                            currDirection.turn()
                        } else {
                            fatalError("This should not happen")
                        }
                    }
                    
                    // move down
                    if currDirection == .down {
                        if i+1 < input.count && input[i+1][j] != "#" {
                            input[i+1][j] = Direction.down.rawValue
                            input[i][j] = "X"
                            i = i+1
                        } else if i+1 == input.count {
                            input[i][j] = "X"
                            exitFound = true
                            break
                        } else if input[i+1][j] == "#" {
                            currDirection.turn()
                        } else {
                            fatalError("This should not happen")
                        }
                    }
                    // move left
                    if currDirection == .left {
                        if j > 0 && input[i][j-1] != "#" {
                            input[i][j-1] = Direction.down.rawValue
                            input[i][j] = "X"
                            j = j-1
                        } else if j == 0 {
                            input[i][j] = "X"
                            exitFound = true
                            break
                        } else if input[i][j-1] == "#" {
                            currDirection.turn()
                        } else {
                            fatalError("This should not happen")
                        }
                    }
                    moveCount += 1
                }
//                print(moveCount)
                
                if !exitFound {
                    loopCount += 1
                }

            }
        }
 
        
        XCTAssertEqual(loopCount, expected)
    }
            
            
    
    func solutionDay6(input: String, expected: Int) {
        var input = input.components(separatedBy: "\n").map { Array($0) }
        var (i, j) = getStartingPoint(input)
        var currDirection = Direction.up
        
        while true {
            // move up
            if currDirection == .up {
                if i > 0 && input[i-1][j] != "#" {
                    input[i-1][j] = Direction.up.rawValue
                    input[i][j] = "X"
                    i = i-1
                } else if i == 0 {
                    input[i][j] = "X"
                    break
                } else if input[i-1][j] == "#" {
                    currDirection.turn()
                } else {
                    fatalError("This should not happen")
                }
            }
            
            // move right
            if currDirection == .right {
                if j+1 < input[i].count && input[i][j+1] != "#" {
                    input[i][j+1] = Direction.right.rawValue
                    input[i][j] = "X"
                    j = j+1
                } else if j+1 == input[i].count {
                    input[i][j] = "X"
                    break
                } else if input[i][j+1] == "#" {
                    currDirection.turn()
                } else {
                    fatalError("This should not happen")
                }
            }
            
            // move down
            if currDirection == .down {
                if i+1 < input.count && input[i+1][j] != "#" {
                    input[i+1][j] = Direction.down.rawValue
                    input[i][j] = "X"
                    i = i+1
                } else if i+1 == input.count {
                    input[i][j] = "X"
                    break
                } else if input[i+1][j] == "#" {
                    currDirection.turn()
                } else {
                    fatalError("This should not happen")
                }
            }
            // move left
            if currDirection == .left {
                if j > 0 && input[i][j-1] != "#" {
                    input[i][j-1] = Direction.down.rawValue
                    input[i][j] = "X"
                    j = j-1
                } else if j-1 == input[i].count {
                    input[i][j] = "X"
                    break
                } else if input[i][j-1] == "#" {
                    currDirection.turn()
                } else {
                    fatalError("This should not happen")
                }
            }
        }
        
        var count = 0
        for i in 0..<input.count {
            for j in 0..<input[i].count {
                if input[i][j] == "X" { count += 1 }
            }
        }
        
        XCTAssertEqual(count, expected)
    }
    
//    func move(_ currP: inout (Int, Int), _ currD: Direction) {
//        
//        
//    }
    
    func pretty(_ input: [[Character]]) {
        print("")
        for line in input {
            print(line)
        }
        print("")
    }
    func getStartingPoint(_ input: [[Character]]) -> (Int, Int) {
        var startingPoint = (0, 0)
        for i in 0..<input.count {
            for j in 0..<input[i].count {
                if input[i][j] == "^" {
                    startingPoint = (i, j)
                }
            }
        }
        return startingPoint
    }
    
    let inputExample = """
....#.....
.........#
..........
..#.......
.......#..
..........
.#..^.....
........#.
#.........
......#...
"""
    
    let input = """
..........#..........#.#.......................................................................#...............#......#...#.......
........................................#..#..........#.........#..#..............................................................
.........#.......................................................................................................#................
..................................#.#..................................#..#.......#.....#.#............#.#........................
...#.......................................................#.........#...................#.................#......................
...............#.........#...........#................................................#..............#...........#.............#..
...................#..#..................................................................#........................................
........##..............................##................................#.....................#...#.............................
................................#...................#...........#.#...........................................................#...
......#......#...........................................#............................................#...#..#....#...............
............................#...#......#.....#.........#...#..#..............#....#...................#.........................#.
....................##.#........#.........#.............#......................#.#....#..............#........................#..#
#....................#......#..........#................................................................................#.........
..............#.............................................................#..........................#........#.....#..........#
.....................#........#......##.#.........#..........#.##.......................................#....#....................
................................................................#..#...........#.........#........................................
...............#..........#..#....#.#.#..................................#................................#..................#....
...................#....#.........................................................................................................
....#........................................................#......#......#.......................................#............#.
................................................#...#...........................................................#.................
..............#............................#.#.........................................#....#.....................................
...........#....#......#..................................................................#.....#..........#.............#.#......
...........................................#........#.#.........#.................#.....#.........................................
.............#.........#.........................#......#.....................#.#.................................................
.............#.....#................#...................................................#.........................................
..#....#............#................#...........................#..................#............#................................
#............................................................#......#..................................#...............#.......#..
.........................#...#.................................................................#..#...........................#..#
.................#.......................................#...............................#...#...#............#..........#........
......................#.........#...............#......#................................#.#....#.......#..........................
.#......##.................................#.................#...#.................#............................................#.
..#..................#.....#.#......#................................#..#...#......##....#..........#..................#..........
.................................................................................#...................................#............
..............................#..#...............................#....#.............................#.......#..................#..
..........#........#.....................................#..............#.....#..#................#........#.#..................#.
....................................#....#..........#........##...................................................................
.......#............................##.......#....#................................................................#.#............
.......................#......................................................#.................#.................................
.......#...................#..................................................................................................#...
.........#.....#................................#...............#........#.....................................#................#.
..#...........................#.....#..........#............................................#........#........#.#.................
...#.........#.............................#......#......................#.......................................#.......#.......#
.........................#.........#........#....................#..................#....#...#.................#..................
...............#.....................................................#....#....^............#.....................................
.......#.......#.....#.............#...........#...#..................................#...#.#....#.........................#......
.............#....................#..................................................#.........................#..................
......................................................##..........................................................................
.....................................#.....................................................................#............#..#....#.
#......................#....................#...#..................#....#.......................................#........#........
.#.....................................................................#...........................#....................##........
............#............#.........................#.........#.....................#..#........#...............................#..
.......#..#...........................................................#..#........#................#................#.............
..............................................................................................................#...................
..#............................#.....#.............#...............#..................................................#...........
..#........#..........................................................................#...........#.....##...................#....
..#.........#...................................#.................................................................................
...#.#......................#.......#...........#.........................................................#..........#............
.............#......#............#............................................................#......#............................
..............#......#...................................................................................................#........
..............#.#............................................................................#......##............................
...........#....................#...................#......#..............#.........................#.....#...#.............#.....
.................#......#................................................................................#...............#........
..#...........................................................................................#...................................
#.............#.......................#..#.....................................#..#.....#.....................#...................
.........#..#...#......#.......#................................#..............#.........#..........................#......#......
.....##...........#................................................................................................#..........#...
.#.........#....................................................##.............................#...#.........#....................
............#...............................#.#...............................................#...............................#...
...............................#..................#...........................#..............................................#....
.#..........#....#.............#.....#.....................#.....................#...................#.........................#..
.............................................................#................##..............#...................#...............
..........................##.........#................................................................................#...........
........#..#...........................#...................................................................#......................
..#.....#...................................................................#.....#....#..#.......#.......#.....#.....#...........
....................................#.......#....#......................................#........................#...........#....
...............#..............#.................#...............#....#....................................................#.......
....#..................#..........................................................................#.......#..........#............
..#...................................................#...............#...............................#......#................#...
.......#............#............................#.......................................#...#....................##..............
...............................#.......#................................#..............#....................#.....................
...........................#..............................................#..........................................#.#..#.......
....#........#....................#...........................................................................................#...
#..................#.....................#....................................#.#............#...................#................
....#........#...#............................#...#.......................#...............#........#....#.........................
.............................................................................................#....#...............#..#............
.........#..........#...........................................................#.#........................#..................#...
.....................................#................#.........#.#..........##......................#..#.........................
.....#..#.....................................................................#.#................................##...............
...............................#....#.#..................................................#.#.........................#........#...
#.......................................##.....#..........................#..#....................#.........#..........#..........
......#.#.............#....##...................................................................#................#....#......#....
..................#...#........................................#........................................#...#.....................
....................#...#...........##...................#..#....#.............................#......#............#..............
.........#.........................................................................#..........#...................................
......................................#...................................................................#.#.#..................#
.......#...#.....#........#..............#................#.........................#.#...........#.#.............#.......#.......
...#.................#......#...........#.............#.....................................#.....................................
.#...........................................................................................................#....................
............#..........#.......................#...........................................................................#....#.
......#....#...#.........................#......#......................##....#.......#.....................#....#.................
....................................#..........................#.......#.......#......................................#........##.
...................#..................................................................................#..............#.#..........
....#..........................#.....................#.#.........#...#......#..#....#.............................................
..................#......#................#........................................#...#........#.................................
...............................#.........#..................................................#.....................................
..................#..............................................#...............#...........#..#.................................
...........................#........................................................#........#....................................
.................#.......#.........##.............#...#....#......................#.......#.......................................
...........#...............#........................................................................#.#...........................
...........#..........#..........................#.....................#....#.........#...................##...#.........#........
.......#.............#........#...........................................#.................................................#.#...
.....................#..................................#.#......#...................#.........................#...#....#..##.....
.......#...................#.............#..#..................................................................#..................
..#........#........................#............#..#...#...........................#......................................#.#....
.............................#..#.......#.........#.....................................................................##...#....
..............##................#........................#..................................................#.....#...#...........
.............#..............#......#..............................................................#...................#...........
#...#............#...........##.............#..........................................#..........................................
..........................#.....#...................#....................#................#.......................................
.....................................................#..................................................................#...#.....
..................#.#........#....#.#.#..#...............................................#.....###..#.........................#...
.#...#.........#..........#.......................................................................#.#............#............#...
...#..............................#.............................#.#............................................#..................
#................................................#..#..........................................................#...............#.#
........................................#.............#..............#...............#.........#...#..............................
..............................#.................#..................#................#.....#.......#..........#....................
............#.......#...........#.........................................................................................#.......
#.#..............................#................#.#...................#.....................#.....................#......#......
.....#..#.......##...........................................#............................#.......................................
.......#..#..#.........#..........................#.#....#..........................#...#........................#.....#..........
"""
}

